@page
@model RVPark.Pages.Customer.Home.IndexModel
@{
    ViewData["Title"] = "Campsites";
}

<div class="container py-5">
    <div class="card shadow-lg border-0 rounded-4">
        <div class="card-header bg-white text-center py-4 border-bottom border-2">
            <h2 class="text-custom-blue-header mb-0"><strong>Explore Our RV Campsites</strong></h2>
        </div>

        <div class="card-body px-4 pt-4 pb-5">
            @* Featured Lot *@
            @if (Model.FeaturedLot != null)
            {
                var featuredImage = !string.IsNullOrWhiteSpace(Model.FeaturedLot.FeaturedImage)
                ? Model.FeaturedLot.FeaturedImage
                : Model.FeaturedLot.Image?.Split(',').FirstOrDefault()?.Trim();

                var featuredPath = !string.IsNullOrWhiteSpace(featuredImage)
                ? featuredImage
                : "/images/default.jpg";

                <div class="card mb-5 border-0 shadow-lg p-4 bg-light rounded-4">
                    <div class="row g-4 align-items-center">
                        <div class="col-md-6 text-center">
                            <img src="@featuredPath" class="img-fluid rounded-4 shadow" style="max-height: 400px;" alt="Featured Lot">
                        </div>
                        <div class="col-md-6">
                            <h3 class="text-custom-blue-header"><strong>@Model.FeaturedLot.LotType?.Name</strong></h3>
                            <p class="text-muted">@Model.FeaturedLot.Description</p>
                            <div class="mb-3">
                                <span class="badge bg-custom-blue px-3 py-2">@Model.FeaturedLot.Location</span>
                                <span class="text-danger fs-5 fw-bold">@Model.FeaturedLot.LotType?.Rate.ToString("C")/night</span>
                            </div>
                            <a asp-page="Details" asp-route-id="@Model.FeaturedLot.Id" class="btn btn-custom-blue">View Details</a>
                        </div>
                    </div>
                </div>
            }

            @* Sorting *@
            <div class="d-flex justify-content-end mb-4">
                <select id="sortOptions" class="form-select w-auto border-custom-blue text-custom-blue">
                    <option value="az">Sort: A - Z</option>
                    <option value="za">Sort: Z - A</option>
                    <option value="high">Sort: Most Expensive</option>
                    <option value="low">Sort: Least Expensive</option>
                </select>
            </div>

            <div id="lotContainer" class="row g-4">
                @foreach (var lot in Model.AvailableLots)
                {
                    var lotName = lot.LotType?.Name ?? "Name unavailable";
                    var lotRate = lot.LotType?.Rate.ToString("C") ?? "Rate unavailable";
                    var lotRateValue = lot.LotType?.Rate ?? 0;

                    var firstImage = lot.Image?.Split(',').FirstOrDefault()?.Trim();
                    var imagePath = !string.IsNullOrWhiteSpace(firstImage)
                    ? firstImage
                    : "/images/default.jpg";

                    <div class="col-lg-4 col-md-6 lot-card" data-name="@lot.Location" data-price="@lotRateValue">
                        <div class="card h-100 border-0 shadow-sm rounded-3">
                            <img src="@imagePath" class="card-img-top rounded-top lot-img" alt="@lot.Location" />
                            <div class="card-body d-flex flex-column">
                                <h4 class="card-title text-custom-blue mb-2"><strong>@lotName</strong></h4>
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <span class="badge bg-custom-blue px-3 py-2">@lot.Location</span>
                                    <span class="text-danger fs-5 fw-bold">@lotRate/night</span>
                                </div>
                                <p class="card-text text-muted mb-4">@lot.Description</p>
                                <a asp-page="Details" asp-route-id="@lot.Id" class="btn btn-outline-custom-blue mt-auto w-100">View Details</a>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<script>
    document.getElementById("sortOptions").addEventListener("change", function () {
        const sortValue = this.value;
        const container = document.getElementById("lotContainer");
        const cards = Array.from(container.getElementsByClassName("lot-card"));

        cards.sort((a, b) => {
            const nameA = a.dataset.name.toLowerCase();
            const nameB = b.dataset.name.toLowerCase();
            const priceA = parseFloat(a.dataset.price);
            const priceB = parseFloat(b.dataset.price);

            switch (sortValue) {
                case "az": return nameA.localeCompare(nameB);
                case "za": return nameB.localeCompare(nameA);
                case "high": return priceB - priceA;
                case "low": return priceA - priceB;
                default: return 0;
            }
        });

        container.innerHTML = "";
        cards.forEach(card => container.appendChild(card));
    });
</script>
